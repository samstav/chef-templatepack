#
# CHEF MANAGED FILE: DO NOT EDIT
# Generated by Chef for <%= node['hostname'] %>
# Controlling Cookbook: <%= @cookbook_name %>
#
[mysqld_safe]
log_error = /var/log/mysql/mysqld.log

[mysqld]
skip_external_locking

## Logging
log_output = FILE
log_slow_admin_statements
log_slow_slave_statements
long_query_time = 2
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log

# Charset and Collation
character_set_server = utf8
collation_server = utf8_general_ci

# lower_case_table_names: Unset
event_scheduler = 0
skip_character_set_client_handshake

#
# The default is now to listen only on Private IP when possible
#
<% if @bind_address -%>

bind_address = <%= @bind_address %>

<% end -%>

#
# * Fine Tuning
#
key_buffer_size = 32M
max_allowed_packet = 256M
thread_stack = 256K
thread_cache_size = 512
sort_buffer_size = 2M
read_buffer_size = 2M
read_rnd_buffer_size = 8M
join_buffer_size = 2M
auto_increment_increment = 1
auto_increment_offset = 1

# This replaces the startup script and checks MyISAM tables if needed
# the first time they are touched
myisam_recover = BACKUP
max_connections = 500
max_connect_errors = 1000000
max_user_connections = 400
concurrent_insert = 2
connect_timeout = 10
wait_timeout = 600
net_read_timeout = 30
net_write_timeout = 30
back_log = 100
interactive_timeout = 3600
slave_net_timeout = 60
skip_name_resolve

table_open_cache = 4096
table_definition_cache = 4096

tmp_table_size = 96M
tmpdir = /dev/shm
max_heap_table_size = 96M
bulk_insert_buffer_size = 32M

# Default Table Settings
sql_mode = NO_ENGINE_SUBSTITUTION

#
# * Query Cache Configuration
#
query_cache_type = 1
query_cache_limit = 2M
query_cache_size = 64M

expire_logs_days = 5
max_binlog_size = 128M
binlog_cache_size = 32K
sync_binlog = 1

# relay_log: Unset
# relay_log_index: Unset
# replicate_do_db: Unset
# replicate_do_table: Unset
# replicate_ignore_db: Unset
# replicate_ignore_table: Unset
# replicate_wild_do_table: Unset
# replicate_wild_ignore_table: Unset
# skip_slave_start: Disabled
# read_only: Disabled
transaction_isolation = READ-COMMITTED
slave_compressed_protocol = 0
# binlog_do_db: Unset
# binlog_ignore_db: Unset

#
# * InnoDB
#
# InnoDB is enabled by default with a 10MB datafile in /var/lib/mysql/.
# Read the manual for more InnoDB related options. There are many!
# You might want to disable InnoDB to shrink the mysqld process by circa 100MB.
# skip_innodb: Disabled
innodb = FORCE

# MySQL version (5.1) < 5.5
# The following options are disabled:
# innodb_write_io_threads = 4
# innodb_io_capacity = 200
# innodb_read_io_threads = 2
# innodb_buffer_pool_instances = _274

## InnoDB Plugin Independent Settings
innodb_log_group_home_dir = /var/lib/mysql
innodb_table_locks = true
innodb_lock_wait_timeout = 300
innodb_thread_concurrency = 32
innodb_purge_threads = 4
innodb_commit_concurrency = 2
innodb_support_xa = true
innodb_buffer_pool_size = <%= node['memory']['total'].to_i < 7500000 ? '512M' : '6G' %>
innodb_log_file_size = 100M
innodb_additional_mem_pool_size = 5M
innodb_data_file_path = ibdata1:10M:autoextend
innodb_flush_log_at_trx_commit = 0

# innodb_log_files_in_group: Unset
# innodb_status_file: Disabled
innodb_file_per_table
# skip_innodb_doublewrite: Disabled
# innodb_flush_method: Unset
innodb_log_buffer_size = 8M
# innodb_adaptive_flushing: Unset
# innodb_adaptive_flushing_method: Unset
# innodb_adaptive_checkpoint: Unset
# innodb_change_buffering: Unset
# innodb_doublewrite: Unset
# innodb_file_format: Unset
innodb_data_home_dir = /var/lib/mysql

# Extra Arguments
character_set_client = utf8
interactive_timeout = 31536000
large_pages
open_files_limit = 65535
relay_log_space_limit = 16G
server_id = <%= @serverid %>
thread_concurrency = 8

[mysqldump]
quick
quote_names
max_allowed_packet = 256M

[mysql]
no_auto_rehash

[myisamchk]
key_buffer = 16M
myisam_sort_buffer_size = 256M
myisam_max_sort_file_size = 2147483648
myisam_repair_threads = 1
myisam_recover = BACKUP
